<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CaneMap - Agricultural Decision Support Platform</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet CSS and JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'cane-green': '#28a745',
                        'cane-dark': '#1e7e34',
                        'cane-light': '#d4edda'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <!-- Header/Navigation -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-cane-green">CaneMap</h1>
                </div>
                <div class="flex-1 flex justify-center">
                    <div class="flex space-x-6">
                        <a href="#features" class="text-gray-700 hover:text-cane-green transition-colors">Features</a>
                        <a href="#about" class="text-gray-700 hover:text-cane-green transition-colors">About us</a>
                        <a href="#contact" class="text-gray-700 hover:text-cane-green transition-colors">Contact</a>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-gray-600"></i>
                        </div>
                        <span class="text-gray-700 font-medium" id="userName">Farmer Name</span>
                    </div>
                    <button class="bg-cane-green text-white px-4 py-2 rounded-lg hover:bg-cane-dark transition-colors text-sm" onclick="window.location.href='register-field.html'">
                        + Register a Field
                    </button>
                </div>
            </div>
        </nav>
    </header>
    <!-- Main Content Area -->
    <main class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Panel - Sugarcane Field Map -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Sugarcane Field Map</h2>
                    <!-- Search Bar -->
                    <div class="mb-4">
                        <div class="flex space-x-2">
                            <input type="text" placeholder="Search for fields, locations..." class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cane-green">
                            <button class="bg-cane-green text-white px-6 py-2 rounded-lg hover:bg-cane-dark transition-colors">Search</button>
                        </div>
                    </div>
                    <!-- Map Container -->
                    <div id="map" class="w-full h-96 rounded-lg border border-gray-200 mb-6"></div>
                    <!-- Get Verified Section -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-800 mb-3">Get Verified for Additional Roles</h3>
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-medium text-gray-700">Apply for Driver Badge</h4>
                                <p class="text-sm text-gray-600">Own or operate hauling vehicles? Drivers are for hauling agricultural field workers.</p>
                            </div>
                            <button onclick="window.location.href='Driver_Badge.html'" class="bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition-colors">Apply Now</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Right Panel -->
            <div class="space-y-6">
                <!-- Notifications -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Notifications</h3>
                    <div class="space-y-4">
                        <div class="flex items-start space-x-3">
                            <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                                <i class="fas fa-check text-green-600 text-xs"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800">Your Request Approved</h4>
                                <p class="text-sm text-gray-600">Payment has been accepted by SRA for field registration.</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-3">
                            <div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                                <i class="fas fa-clipboard text-blue-600 text-xs"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800">Task assignment</h4>
                                <p class="text-sm text-gray-600">New weeding task assigned for this week.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Weather Forecast -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Weather Forecast</h3>
                    <div class="space-y-3" id="weatherForecast">
                        <!-- Weather data will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!-- Features Section -->
    <section id="features" class="bg-gray-100 py-16">
        <div class="container mx-auto px-4">
            <h2 class="text-4xl font-bold text-center text-gray-800 mb-12">FEATURES</h2>
            <div class="relative">
                <div class="flex space-x-6 overflow-x-auto pb-4" id="featuresCarousel">
                    <div class="flex-shrink-0 w-80 h-64 bg-gray-300 rounded-lg flex items-center justify-center">
                        <span class="text-gray-600 font-medium">Field Management</span>
                    </div>
                    <div class="flex-shrink-0 w-80 h-64 bg-gray-300 rounded-lg flex items-center justify-center border-4 border-cane-green">
                        <span class="text-gray-600 font-medium">Field Registration</span>
                    </div>
                    <div class="flex-shrink-0 w-80 h-64 bg-gray-300 rounded-lg flex items-center justify-center">
                        <span class="text-gray-600 font-medium">Task Coordination</span>
                    </div>
                </div>
                <button class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white rounded-full p-2 shadow-md hover:shadow-lg transition-shadow" onclick="scrollFeatures('left')">
                    <i class="fas fa-chevron-left text-gray-600"></i>
                </button>
                <button class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white rounded-full p-2 shadow-md hover:shadow-lg transition-shadow" onclick="scrollFeatures('right')">
                    <i class="fas fa-chevron-right text-gray-600"></i>
                </button>
            </div>
        </div>
    </section>
    <!-- About Us Section -->
    <section id="about" class="py-16">
        <div class="container mx-auto px-4">
            <h2 class="text-4xl font-bold text-center text-gray-800 mb-12">ABOUT US</h2>
            <div class="max-w-4xl mx-auto text-center mb-12">
                <p class="text-lg text-gray-700 leading-relaxed">
                    CaneMap is an agricultural decision-support platform designed to help sugarcane farmers and field workers register land, track field progress, and collaborate with the Sugar Regulatory Administration (SRA) for better transparency and productivity. Developed in collaboration with local stakeholders and SRA Region 8, CaneMap empowers farmers through digital mapping, task coordination, and predictive analytics to make informed decisions throughout the crop cycle.
                </p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                <div class="bg-gray-100 p-8 rounded-lg text-center">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Mission</h3>
                    <p class="text-gray-700">To empower sugarcane farmers with digital tools for better decision-making and productivity.</p>
                </div>
                <div class="bg-gray-100 p-8 rounded-lg text-center">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Vision</h3>
                    <p class="text-gray-700">To be the leading agricultural technology platform for sugarcane farming in the Philippines.</p>
                </div>
            </div>
        </div>
    </section>
    <!-- Contact Section -->
    <section id="contact" class="bg-gray-100 py-16">
        <div class="container mx-auto px-4">
            <h2 class="text-4xl font-bold text-center text-gray-800 mb-12">CONTACT</h2>
            <div class="max-w-2xl mx-auto">
                <div class="bg-white rounded-lg shadow-md p-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Get in Touch</h3>
                            <div class="space-y-3">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-envelope text-cane-green"></i>
                                    <span class="text-gray-700">info@canemap.com</span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-phone text-cane-green"></i>
                                    <span class="text-gray-700">+63 912 345 6789</span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-map-marker-alt text-cane-green"></i>
                                    <span class="text-gray-700">SRA Region 8, Philippines</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Send Message</h3>
                            <form class="space-y-3">
                                <input type="text" placeholder="Your Name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cane-green">
                                <input type="email" placeholder="Your Email" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cane-green">
                                <textarea placeholder="Your Message" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cane-green"></textarea>
                                <button type="submit" class="w-full bg-cane-green text-white py-2 rounded-lg hover:bg-cane-dark transition-colors">Send Message</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="text-center md:text-left mb-4 md:mb-0">
                    <p class="text-sm text-gray-300">© 2023 CaneMap. All rights reserved. Developed by the CaneMap Team in collaboration with SRA Region 8.</p>
                    <div class="mt-2 space-x-4 text-sm">
                        <a href="#" class="text-gray-300 hover:text-white transition-colors">Terms of Service</a>
                        <a href="#" class="text-gray-300 hover:text-white transition-colors">Privacy Policy</a>
                        <a href="#" class="text-gray-300 hover:text-white transition-colors">Help Center</a>
                    </div>
                </div>
                <button onclick="scrollToTop()" class="bg-black rounded-full p-3 hover:bg-gray-900 transition-colors">
                    <i class="fas fa-arrow-up text-white"></i>
                </button>
            </div>
        </div>
    </footer>
    <!-- Firebase JS SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script>
        // Firebase config (replace with your actual config)
        const firebaseConfig = {
          apiKey: "AIzaSyAWcIMy6hBF4aP6LTSS1PwtmZogUebAI4A",
          authDomain: "canemap-system.firebaseapp.com",
          projectId: "canemap-system",
          storageBucket: "canemap-system.firebasestorage.app",
          messagingSenderId: "624993566775",
          appId: "1:624993566775:web:5b1b72cb58203b46123fb2",
          measurementId: "G-08KFJQ1NEJ"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        // Listen for notifications for the logged-in user
        function listenNotifications() {
            const userName = localStorage.getItem('farmerName') || 'Farmer Name';
            db.collection('notifications')
                .where('recipient', '==', userName)
                .orderBy('timestamp', 'desc')
                .onSnapshot(snapshot => {
                    const container = document.querySelector('.space-y-4');
                    if (!container) return;
                    container.innerHTML = '';
                    snapshot.forEach(doc => {
                        const notif = doc.data();
                        container.innerHTML += `
                            <div class=\"flex items-start space-x-3\">
                                <div class=\"w-6 h-6 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-1\">
                                    <i class=\"fas fa-bell text-green-600 text-xs\"></i>
                                </div>
                                <div>
                                    <h4 class=\"font-medium text-gray-800\">${notif.title}</h4>
                                    <p class=\"text-sm text-gray-600\">${notif.body}</p>
                                    <span class=\"text-xs text-gray-400\">${new Date(notif.timestamp.seconds * 1000).toLocaleString()}</span>
                                </div>
                            </div>
                        `;
                    });
                });
        }
        // Initialize map
        let map;
        function initMap() {
            map = L.map('map').setView([12.8797, 121.7740], 6);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);
            // Only show fields registered to the current user
            const userName = localStorage.getItem('farmerName') || 'Farmer Name';
            // Example: fetch registered fields from Firestore
            db.collection('fields').where('owner', '==', userName).get().then(snapshot => {
                snapshot.forEach(doc => {
                    const field = doc.data();
                    const marker = L.marker([field.lat, field.lng])
                        .addTo(map)
                        .bindPopup(`<b>${field.name}</b><br>Sugarcane Field`);
                    const bounds = [
                        [field.lat - 0.01, field.lng - 0.01],
                        [field.lat + 0.01, field.lng + 0.01]
                    ];
                    L.rectangle(bounds, { color: '#666', weight: 1, fillOpacity: 0.1 }).addTo(map);
                });
            });
        }
        // Weather API integration
        async function getWeather() {
            try {
                const apiKey = '2d59a2816a02c3178386f3d51233b2ea';
                const lat = 11.0064; // Ormoc City latitude
                const lon = 124.6075; // Ormoc City longitude
                const url = `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}`;
                const response = await fetch(url);
                const data = await response.json();
                const weatherContainer = document.getElementById('weatherForecast');
                if (!data.list) {
                    let errorMsg = 'Weather data unavailable.';
                    if (data.message) {
                        errorMsg += `<br><span class='text-xs text-gray-500'>API: ${data.message}</span>`;
                    }
                    weatherContainer.innerHTML = `<div class='text-red-500'>${errorMsg}</div>`;
                    return;
                }
                // Group forecasts by day
                const days = {};
                data.list.forEach(item => {
                    const date = new Date(item.dt * 1000);
                    const dayStr = date.toLocaleDateString();
                    if (!days[dayStr]) {
                        days[dayStr] = [];
                    }
                    days[dayStr].push(item);
                });
                // Get today, tomorrow, and next day
                const dayKeys = Object.keys(days).slice(0, 3);
                const dayNames = ['Today', 'Tomorrow', new Date(dayKeys[2]).toLocaleDateString('en-US', { weekday: 'long' })];
                const html = dayKeys.map((key, idx) => {
                    // Use the forecast closest to noon for each day
                    const forecasts = days[key];
                    let forecast = forecasts.find(f => new Date(f.dt * 1000).getHours() === 12) || forecasts[Math.floor(forecasts.length / 2)];
                    const temp = `${Math.round(forecast.main.temp_min)}°C / ${Math.round(forecast.main.temp_max)}°C`;
                    const icon = forecast.weather[0].icon;
                    const desc = forecast.weather[0].description;
                    return `
                        <div class=\"flex items-center justify-between\">
                            <div class=\"flex items-center space-x-3\">
                                <img src=\"https://openweathermap.org/img/wn/${icon}@2x.png\" alt=\"${desc}\" class=\"w-8 h-8\" />
                                <span class=\"font-medium text-gray-700\">${dayNames[idx]}</span>
                            </div>
                            <span class=\"text-gray-600\">${temp} - ${desc}</span>
                        </div>
                    `;
                }).join('');
                weatherContainer.innerHTML = html;
            } catch (error) {
                console.error('Error fetching weather:', error);
                document.getElementById('weatherForecast').innerHTML = `<div class='text-red-500'>Weather data unavailable.<br><span class='text-xs text-gray-500'>${error}</span></div>`;
            }
        }
        // Features carousel functionality
        function scrollFeatures(direction) {
            const carousel = document.getElementById('featuresCarousel');
            const scrollAmount = 320;
            if (direction === 'left') {
                carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
            } else {
                carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' });
            }
        }
        // Smooth scrolling for navigation links
        function smoothScroll(targetId) {
            const target = document.getElementById(targetId);
            if (target) {
                target.scrollIntoView({ behavior: 'smooth' });
            }
        }
        // Scroll to top functionality
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        // Update user name from localStorage or session
        function updateUserName() {
            const userName = localStorage.getItem('farmerName') || 'Farmer Name';
            document.getElementById('userName').textContent = userName;
        }
        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            getWeather();
            updateUserName();
            listenNotifications();
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    smoothScroll(targetId);
                });
            });
        });
        window.addEventListener('scroll', function() {
            const header = document.querySelector('header');
            if (window.scrollY > 0) {
                header.classList.add('shadow-lg');
            } else {
                header.classList.remove('shadow-lg');
            }
        });
    </script>
</body>
</html>
